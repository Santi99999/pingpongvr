<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene cursor="rayOrigin: mouse">
      <a-entity id="camera" camera look-controls position="0 1.6 0"></a-entity>

      <a-entity environment="preset: chess"></a-entity>

      <a-entity id="blocks"></a-entity>

      <a-entity id="teleport-cursor" cursor="rayOrigin: mouse; fuse: true; fuseTimeout: 500"
        position="0 0 -1"
        geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
        material="color: black; shader: flat">
      </a-entity>

      <a-entity id="teleport-raycaster" raycaster="objects: .teleport-target"
        line="color: red; opacity: 0.5; lineWidth: 6">
      </a-entity>
    </a-scene>

    <script>
      AFRAME.registerComponent('teleport', {
        init: function () {
          var el = this.el;

          el.addEventListener('raycaster-intersection', function (evt) {
            var intersection = evt.detail.intersections[0];
            var cursor = document.querySelector('#teleport-cursor');
            cursor.setAttribute('position', intersection.point);
          });

          el.addEventListener('raycaster-intersection-cleared', function (evt) {
            var cursor = document.querySelector('#teleport-cursor');
            cursor.setAttribute('position', '0 0 -1');
          });

          el.addEventListener('click', function () {
            var cursor = document.querySelector('#teleport-cursor');
            var camera = document.querySelector('#camera');
            camera.setAttribute('position', cursor.getAttribute('position'));
          });
        }
      });

      AFRAME.registerComponent('block-spawner', {
        init: function () {
          var el = this.el;

          setInterval(function () {
            var block = document.createElement('a-box');
            block.setAttribute('position', getRandomPosition());
            block.setAttribute('color', getRandomColor());
            block.setAttribute('class', 'teleport-target');
            block.setAttribute('scale', '0.5 0.5 0.5');
            block.setAttribute('remove-on-click', '');
            el.appendChild(block);
          }, 10000);
        }
      });

      AFRAME.registerComponent('remove-on-click', {
        init: function () {
          var el = this.el;
          el.addEventListener('click', function () {
            el.parentNode.removeChild(el);
          });
        }
      });

      function getRandomPosition() {
        var x = Math.random() * 4 - 2;
        var z = Math.random() * 4 - 2;
        return x + ' 0.25 ' + z;
      }

      function getRandomColor() {
        var letters = '0123456789ABCDEF';
        var color = '#';
        for (var i = 0; i < 6; i++) {
          color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
      }
    </script>
  </body>
</html>
